<!doctype html>

<head>
    {% include "jsimports.html"%}
</head>

<body id="index">
    {% include "navbar.html"%}
    <section class="ui grid">
        <div class="two wide column"></div>
        <div class="twelve wide column center aligned stackable divided grid">
            <div class="column">
                <div class="ui icon input" id="search-home">
                    <input type="text" placeholder="Apple, Carrot, etc." id="search-input">
                    <i class="circular inverted green search link icon" id="search-icon"></i>
                </div>
            </div>
        </div>
    </section>
    <script> 
        $(document).ready(function() {
            var searchInput = $("#search-input");
            searchInput.autocomplete({
                source: function( request, response ) {
                        var matcher = new RegExp($.trim(request.term).replace(/[-[\]{}()*+?.,\\^$|#\s]/g, "\\$&"), "i" );
                        response($.grep(resources, function(value) {
                            return matcher.test( value.label || value.value || value );
                        }));
                         },
                select: function(event, suggestion){
                            window.location.href=suggestion.item.data;
                        }
            });

            searchInput.keypress(function (e) {
                if(e.which == 13) {
                    var search = searchInput.val().toLowerCase().replace(/\s+/g,"");
                    var suggestions = []
                    $("#ui-id-2 li").each(function(index) {
                        suggestions.push(jQuery("a", this).text().toLowerCase().replace(/\s+/g,""));
                    });
                    
                    for (var index = 0; index < suggestions.length; index++) {
                        var suggestion = suggestions[index];
                        if (search == suggestion) {
                            var keyEvent = $.Event("keydown");  
                            keyEvent.keyCode = $.ui.keyCode.DOWN;
                            for (var k = 0; k < index + 1; k++) {
                                searchInput.trigger(keyEvent);
                            }
                            keyEvent.keyCode = $.ui.keyCode.ENTER;
                            searchInput.trigger(keyEvent);
                        }
                    }
                }
            });

            $("#search-icon").click(function() {
                var search = searchInput.val().toLowerCase().replace(/\s+/g,"");
                var suggestions = []
                $("#ui-id-2 li").each(function(index) {
                    suggestions.push(jQuery("a", this).text().toLowerCase().replace(/\s+/g,""));
                });

                for (var index = 0; index < suggestions.length; index++) {
                    var suggestion = suggestions[index];
                    if (search == suggestion) {
                        var keyEvent = $.Event("keydown");  
                        keyEvent.keyCode = $.ui.keyCode.DOWN;
                        for (var k = 0; k < index + 2; k++) {
                            searchInput.trigger(keyEvent);
                        }
                        keyEvent.keyCode = $.ui.keyCode.ENTER;
                        searchInput.trigger(keyEvent);
                    }
                }
            });
            $("#home_nav").addClass("active");
        });
    </script>
</body>
